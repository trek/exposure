<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
     <meta http-equiv="content-type" content="text/html; charset=utf-8" />
     <title>Exposure finding</title>
     <meta name="author" content="Trek glowakcki" />
     <!-- syntax highlighting CSS -->
     <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
     <!-- Homepage CSS -->
     <link rel="stylesheet" href="/css/style.css" type="text/css" media="screen, projection" />
  </head>
  <body>
    
    <div class="container">
      
      <h1>Finding</h1>

<p>The default behavior for finding resources in exposure is finding with the named scope of <code>all</code> for multiple resources and finding by <code>id</code> obtained from <code>params</code> for singular resources.  The following code example:</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">MembersController</span>
  <span class="n">expose</span> <span class="ss">:members</span>
<span class="k">end</span>
</pre>
</div>


<p>will find all members with <code>Member.all</code> and individual members with <code>Member.find(params[:id])</code>.  Finding a collection of resources occurs in the <code>index</code> action. Finding individual resources occurs in <code>show</code>, <code>edit</code>, <code>update</code>, and <code>destroy</code> actions.  Found resources are referenced by two variable names, based on their resource type.  With a resource type of <code>Member</code>, collections will be referenced by <code>@resources</code> and <code>@members</code>.  Individual resources will be referenced by <code>@resource</code> and <code>@member</code>.</p>

<p>The following tables summarizes finding and variable assignment in resource controllers:<br/>
</p>

<table>
<thead>
<tr>
<th>Action </th>
<th> Finder called                </th>
<th> Assigned variables</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>index</code></td>
<td> <code>Business.all</code>               </td>
<td> <code>@resources</code>, <code>@businesses</code></td>
</tr>
<tr>
<td><code>show</code> </td>
<td> <code>Business.find(params[:id])</code> </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
<tr>
<td><code>new</code>  </td>
<td>                              </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
<tr>
<td><code>create</code> </td>
<td>                            </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
<tr>
<td><code>edit</code> </td>
<td> <code>Business.find(params[:id])</code> </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
<tr>
<td><code>update</code> </td>
<td> <code>Business.find(params[:id])</code> </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
<tr>
<td><code>destroy</code></td>
<td> <code>Business.find(params[:id])</code> </td>
<td> <code>@resource</code>, <code>@business</code></td>
</tr>
</tbody>
</table>


<h2>Customized Finding</h2>

<p>Default finding can be customized with the ActionController method <code>finder_for</code>. You can replace a finder with a method name (as symbol), Proc object, or a block.  The result of execution will be stored in the resource's variable name</p>

<div class="highlight"><pre><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">expose</span> <span class="ss">:posts</span>
  <span class="n">finder_for</span> <span class="ss">:post</span><span class="p">,</span> <span class="ss">:is</span> <span class="o">=&gt;</span> <span class="ss">:current_post</span>
  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">current_post</span>
      <span class="no">Post</span><span class="o">.</span><span class="n">find_by_permalink</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:permalink</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>




<div class="highlight"><pre><span class="k">class</span> <span class="nc">ProductsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">expose</span> <span class="ss">:products</span>
  <span class="n">finder_for</span> <span class="ss">:products</span><span class="p">,</span> <span class="ss">:is</span> <span class="o">=&gt;</span> <span class="no">Proc</span><span class="o">.</span><span class="n">new</span> <span class="p">{</span> <span class="no">Product</span><span class="o">.</span><span class="n">top_sellers</span>  <span class="p">}</span>
<span class="k">end</span>
</pre>
</div>




<div class="highlight"><pre><span class="k">class</span> <span class="nc">PuppiesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">expose</span> <span class="ss">:puppies</span>
  <span class="n">finder_for</span> <span class="ss">:puppy</span> <span class="k">do</span>
    <span class="no">Puppy</span><span class="o">.</span><span class="n">find_by_name_and_breed</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">,</span> <span class="n">params</span><span class="o">[</span><span class="ss">:breed_id</span><span class="o">]</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p><a href="/exposing.html">Previous: Exposing Resources</a> <a href="/building.html">Next: Building</a></p>

      
      <div class="footer"></div>
    </div>
    
    <a href="http://github.com/trek/exposure">
      <img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
    </a>
  </body>
</html>
